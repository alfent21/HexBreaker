<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexBreaker Editor</title>
    <link rel="stylesheet" href="css/editor.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="editor-container">
        <!-- Menu Bar -->
        <nav class="menu-bar">
            <div class="menu-item" data-menu="file">
                „Éï„Ç°„Ç§„É´
                <div class="menu-dropdown">
                    <div class="menu-dropdown-item" id="menu-new">
                        <span>Êñ∞Ë¶è‰ΩúÊàê</span>
                        <span class="shortcut">Ctrl+N</span>
                    </div>
                    <div class="menu-dropdown-item" id="menu-open">
                        <span>Èñã„Åè</span>
                        <span class="shortcut">Ctrl+O</span>
                    </div>
                    <div class="menu-dropdown-item" id="menu-save">
                        <span>‰øùÂ≠ò</span>
                        <span class="shortcut">Ctrl+S</span>
                    </div>
                    <div class="context-menu-separator"></div>
                    <div class="menu-dropdown-item" id="menu-export">
                        <span>„Ç®„ÇØ„Çπ„Éù„Éº„Éà</span>
                    </div>
                </div>
            </div>
            <div class="menu-item" data-menu="edit">
                Á∑®ÈõÜ
                <div class="menu-dropdown">
                    <div class="menu-dropdown-item" id="menu-undo">
                        <span>ÂÖÉ„Å´Êàª„Åô</span>
                        <span class="shortcut">Ctrl+Z</span>
                    </div>
                    <div class="menu-dropdown-item" id="menu-redo">
                        <span>„ÇÑ„ÇäÁõ¥„Åô</span>
                        <span class="shortcut">Ctrl+Y</span>
                    </div>
                </div>
            </div>
            <div class="menu-item" data-menu="view">
                Ë°®Á§∫
                <div class="menu-dropdown">
                    <div class="menu-dropdown-item" id="menu-toggle-grid">
                        <span>„Ç∞„É™„ÉÉ„ÉâË°®Á§∫</span>
                        <span class="shortcut">H</span>
                    </div>
                    <div class="menu-dropdown-item" id="menu-toggle-lines">
                        <span>Á∑öÂàÜË°®Á§∫</span>
                    </div>
                    <div class="menu-dropdown-item" id="menu-reset-view">
                        <span>„Éì„É•„Éº„Çí„É™„Çª„ÉÉ„Éà</span>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="toolbar-group">
                <button class="btn btn--icon" id="btn-new" data-tooltip="Êñ∞Ë¶è‰ΩúÊàê">
                    <i class="fas fa-file"></i>
                </button>
                <button class="btn btn--icon" id="btn-open" data-tooltip="Èñã„Åè">
                    <i class="fas fa-folder-open"></i>
                </button>
                <button class="btn btn--icon" id="btn-save" data-tooltip="‰øùÂ≠ò">
                    <i class="fas fa-save"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="btn btn--icon" id="btn-undo" data-tooltip="ÂÖÉ„Å´Êàª„Åô (Ctrl+Z)">
                    <i class="fas fa-undo"></i>
                </button>
                <button class="btn btn--icon" id="btn-redo" data-tooltip="„ÇÑ„ÇäÁõ¥„Åô (Ctrl+Y)">
                    <i class="fas fa-redo"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group view-toggle">
                <label>
                    <input type="checkbox" id="grid-toggle" checked>
                    „Ç∞„É™„ÉÉ„Éâ
                </label>
                <label>
                    <input type="checkbox" id="line-toggle" checked>
                    „É©„Ç§„É≥
                </label>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <label class="label" style="margin-right: 4px;">„Çπ„ÉÜ„Éº„Ç∏:</label>
                <select class="select" id="stage-select" style="min-width: 120px;">
                    <!-- Populated dynamically -->
                </select>
                <button class="btn btn--icon btn--small" id="btn-add-stage" data-tooltip="Êñ∞Ë¶è„Çπ„ÉÜ„Éº„Ç∏">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-separator"></div>

            <div class="toolbar-group">
                <button class="btn btn--icon btn--primary" id="btn-preview" data-tooltip="„Éó„É¨„Éì„É•„Éº (P)">
                    <i class="fas fa-play"></i>
                    „Éó„É¨„Éì„É•„Éº
                </button>
            </div>

            <div class="toolbar-group zoom-controls">
                <button class="btn btn--icon btn--small" id="btn-zoom-out">
                    <i class="fas fa-search-minus"></i>
                </button>
                <span id="zoom-level" class="zoom-level">100%</span>
                <button class="btn btn--icon btn--small" id="btn-zoom-in">
                    <i class="fas fa-search-plus"></i>
                </button>
            </div>
        </div>

        <!-- Left Panel -->
        <div class="left-panel">
            <!-- Tool Palette -->
            <div class="panel-section">
                <div class="panel-title">„ÉÑ„Éº„É´</div>
                <div class="tool-palette" id="tool-palette">
                    <button class="tool-btn active" id="tool-brush" data-tooltip="„Éñ„É©„Ç∑ (B)">
                        <i class="fas fa-paint-brush"></i>
                    </button>
                    <button class="tool-btn" id="tool-eraser" data-tooltip="Ê∂à„Åó„Ç¥„É† (E)">
                        <i class="fas fa-eraser"></i>
                    </button>
                    <button class="tool-btn" id="tool-fill" data-tooltip="Â°ó„Çä„Å§„Å∂„Åó (G)">
                        <i class="fas fa-fill-drip"></i>
                    </button>
                    <button class="tool-btn" id="tool-select" data-tooltip="ÈÅ∏Êäû (V)">
                        <i class="fas fa-mouse-pointer"></i>
                    </button>
                    <button class="tool-btn" id="tool-line" data-tooltip="„É©„Ç§„É≥ (L)">
                        <i class="fas fa-bezier-curve"></i>
                    </button>
                    <button class="tool-btn" id="tool-eyedropper" data-tooltip="„Çπ„Éù„Ç§„Éà (I)">
                        <i class="fas fa-eye-dropper"></i>
                    </button>
                </div>
            </div>

            <!-- Brush Size -->
            <div class="panel-section">
                <div class="panel-title">„Éñ„É©„Ç∑„Çµ„Ç§„Ç∫</div>
                <div class="brush-size-selector">
                    <button class="brush-size-btn" id="brush-s">S</button>
                    <button class="brush-size-btn active" id="brush-m">M</button>
                    <button class="brush-size-btn" id="brush-l">L</button>
                </div>
            </div>

            <!-- Block Settings -->
            <div class="panel-section">
                <div class="panel-title">„Éñ„É≠„ÉÉ„ÇØË®≠ÂÆö</div>
                <div class="form-group">
                    <label class="label">ËÄê‰πÖÂÄ§</label>
                    <div class="durability-selector">
                        <button class="durability-btn active" data-durability="1"
                            style="background-color: #64B5F6;">1</button>
                        <button class="durability-btn" data-durability="2" style="background-color: #4FC3F7;">2</button>
                        <button class="durability-btn" data-durability="3" style="background-color: #4DD0E1;">3</button>
                        <button class="durability-btn" data-durability="4" style="background-color: #4DB6AC;">4</button>
                        <button class="durability-btn" data-durability="5" style="background-color: #81C784;">5</button>
                        <button class="durability-btn" data-durability="6" style="background-color: #AED581;">6</button>
                        <button class="durability-btn" data-durability="7" style="background-color: #DCE775;">7</button>
                        <button class="durability-btn" data-durability="8" style="background-color: #FFD54F;">8</button>
                        <button class="durability-btn" data-durability="9" style="background-color: #FF8A65;">9</button>
                        <button class="durability-btn" data-durability="10"
                            style="background-color: #E57373;">10</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="label">Ëâ≤</label>
                    <input type="color" class="color-picker" id="block-color" value="#64B5F6">
                </div>
            </div>

            <div class="divider"></div>

            <!-- Line Properties -->
            <div class="panel-section">
                <div class="panel-title">„É©„Ç§„É≥Ë®≠ÂÆö</div>
                <div class="form-group line-type-selector">
                    <button class="line-type-btn active" data-type="collision">Â£Å</button>
                    <button class="line-type-btn" data-type="paddle">„Éë„Éâ„É´</button>
                    <button class="line-type-btn" data-type="missline">„Éü„Çπ</button>
                    <button class="line-type-btn" data-type="decoration">Ë£ÖÈ£æ</button>
                </div>
                <div class="form-group">
                    <label class="label">Ëâ≤</label>
                    <input type="color" class="color-picker" id="line-color" value="#FFFF00">
                </div>
                <div class="form-group">
                    <label class="label">Â§™„Åï</label>
                    <input type="number" class="input input--small" id="line-thickness" value="3" min="1" max="20">
                </div>
                <div class="form-group">
                    <label class="label">‰∏çÈÄèÊòéÂ∫¶</label>
                    <input type="range" class="slider" id="line-opacity" value="1" min="0" max="1" step="0.1">
                </div>
            </div>
        </div>

        <!-- Canvas Container -->
        <div class="canvas-container">
            <div class="canvas-wrapper">
                <canvas id="mainCanvas" width="1280" height="720"></canvas>
                <canvas id="overlayCanvas" width="1280" height="720"></canvas>
            </div>
            <div class="canvas-info">
                <span id="canvas-size-info">1280 x 720</span>
                <span id="cursor-pos-info">X: 0, Y: 0</span>
                <span id="hex-pos-info">Row: 0, Col: 0</span>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Tabs -->
            <div class="panel-tabs">
                <button class="panel-tab active" data-tab="layers">„É¨„Ç§„É§„Éº</button>
                <button class="panel-tab" data-tab="stages">„Çπ„ÉÜ„Éº„Ç∏</button>
            </div>

            <!-- Layer Tab -->
            <div class="panel-content" id="tab-layers">
                <div class="layer-list" id="layer-list">
                    <!-- Layers will be rendered here -->
                </div>
                <button class="add-layer-btn" id="btn-add-image">
                    <i class="fas fa-image"></i>
                    ÁîªÂÉè„É¨„Ç§„É§„Éº„ÇíËøΩÂä†
                </button>
                <button class="add-layer-btn" id="btn-add-block-layer">
                    <i class="fas fa-cubes"></i>
                    „Éñ„É≠„ÉÉ„ÇØ„É¨„Ç§„É§„Éº„ÇíËøΩÂä†
                </button>
            </div>

            <!-- Stage Tab (hidden by default) -->
            <div class="panel-content hidden" id="tab-stages">
                <div class="stage-list" id="stage-list">
                    <!-- Stages will be rendered here -->
                </div>
                <button class="add-layer-btn" id="btn-create-stage">
                    <i class="fas fa-plus"></i>
                    „Çπ„ÉÜ„Éº„Ç∏„Çí‰ΩúÊàê
                </button>
            </div>
        </div>

        <!-- Message Panel -->
        <div class="message-panel">
            <div class="message-header">
                <span class="message-title">„É°„ÉÉ„Çª„Éº„Ç∏</span>
                <div class="message-header-buttons">
                    <button class="message-copy-all-btn" id="btn-copy-messages" title="ÂÖ®„Å¶„Ç≥„Éî„Éº">üìã</button>
                    <button class="message-clear-btn" id="btn-clear-messages">„ÇØ„É™„Ç¢</button>
                </div>
            </div>
            <div class="message-list" id="message-list">
                <div class="message info">
                    <span class="message-icon">‚ÑπÔ∏è</span>
                    <span class="message-text">HexBreaker Editor „Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ</span>
                </div>
            </div>
        </div>
    </div>

    <!-- New Stage Dialog -->
    <div class="modal-overlay hidden" id="new-stage-dialog">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">Êñ∞Ë¶è„Çπ„ÉÜ„Éº„Ç∏‰ΩúÊàê</span>
                <button class="modal-close" id="new-stage-cancel">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="label">„Çπ„ÉÜ„Éº„Ç∏Âêç</label>
                    <input type="text" class="input" id="new-stage-name" placeholder="Stage 1" value="">
                </div>

                <div class="form-group">
                    <label class="label">„Éô„Éº„ÇπÁîªÂÉèÔºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ</label>
                    <input type="file" class="input" id="new-stage-image" accept="image/png,image/jpeg,image/gif">
                    <small style="color: var(--color-text-muted); display: block; margin-top: 4px;">
                        ÁîªÂÉè„Çµ„Ç§„Ç∫„Åå„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫„Å®„Åó„Å¶‰ΩøÁî®„Åï„Çå„Åæ„Åô
                    </small>
                </div>

                <div class="form-group">
                    <label class="label">„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫ÔºàÊâãÂãïË®≠ÂÆöÔºâ</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="number" class="input" id="new-stage-width" value="1280" style="width: 80px;">
                        <span>√ó</span>
                        <input type="number" class="input" id="new-stage-height" value="720" style="width: 80px;">
                        <span>px</span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="label">„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫Ôºà„Éñ„É≠„ÉÉ„ÇØÂØÜÂ∫¶Ôºâ</label>
                    <div style="display: flex; flex-direction: column; gap: 4px;">
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="grid-size" value="small">
                            <span>Â∞è (10px) - Á¥∞„Åã„ÅÑ„Éñ„É≠„ÉÉ„ÇØ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="grid-size" value="medium" checked>
                            <span>‰∏≠ (30px) - Ê®ôÊ∫ñ</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="radio" name="grid-size" value="large">
                            <span>Â§ß (50px) - Â§ß„Åç„ÅÑ„Éñ„É≠„ÉÉ„ÇØ</span>
                        </label>
                    </div>
                    <small style="color: var(--color-warning); display: block; margin-top: 8px;">
                        ‚ö† „Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„ÅØ‰ΩúÊàêÂæå„Å´Â§âÊõ¥„Åß„Åç„Åæ„Åõ„Çì
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" id="new-stage-cancel-btn">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn--primary" id="new-stage-create-btn">‰ΩúÊàê</button>
            </div>
        </div>
    </div>

    <!-- Blockify Dialog -->
    <div class="modal-overlay hidden" id="blockify-dialog">
        <div class="modal">
            <div class="modal-header">
                <span class="modal-title">„Éñ„É≠„ÉÉ„ÇØÂåñ</span>
                <button class="modal-close" id="blockify-close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="label">„ÇΩ„Éº„ÇπÁîªÂÉè„É¨„Ç§„É§„Éº</label>
                    <select class="select" id="blockify-source" style="width: 100%;">
                        <!-- Populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫</label>
                    <select class="select" id="blockify-grid-size" style="width: 100%;">
                        <option value="small">Â∞è (10px)</option>
                        <option value="medium" selected>‰∏≠ (30px)</option>
                        <option value="large">Â§ß (50px)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="label">„Ç¢„É´„Éï„Ç°„Åó„Åç„ÅÑÂÄ§: <span id="blockify-alpha-value">128</span></label>
                    <input type="range" class="slider" id="blockify-alpha-threshold"
                        min="1" max="255" value="128" style="width: 100%;">
                    <small style="color: var(--color-text-muted);">
                        „Åì„ÅÆÂÄ§‰ª•‰∏ä„ÅÆ„Ç¢„É´„Éï„Ç°„ÇíÊåÅ„Å§„Éî„ÇØ„Çª„É´„Çí„Éñ„É≠„ÉÉ„ÇØÂØæË±°„Å®„Åø„Å™„Åó„Åæ„Åô
                    </small>
                </div>

                <div class="form-group">
                    <label class="label">„Ç´„Éê„É¨„ÉÉ„Ç∏„Åó„Åç„ÅÑÂÄ§: <span id="blockify-coverage-value">30%</span></label>
                    <input type="range" class="slider" id="blockify-coverage-threshold"
                        min="0.1" max="1" step="0.05" value="0.3" style="width: 100%;">
                    <small style="color: var(--color-text-muted);">
                        „Éò„ÉÉ„ÇØ„ÇπÂÜÖ„ÅÆ„Åì„ÅÆÂâ≤Âêà‰ª•‰∏ä„Åå„Ç¢„É´„Éï„Ç°„Åó„Åç„ÅÑÂÄ§„ÇíË∂Ö„Åà„Åü„Çâ„Éñ„É≠„ÉÉ„ÇØÈÖçÁΩÆ
                    </small>
                </div>

                <div class="form-group">
                    <label class="label">„Éá„Éï„Ç©„É´„ÉàËÄê‰πÖÂÄ§</label>
                    <select class="select" id="blockify-durability" style="width: 100%;">
                        <option value="1">1</option>
                        <option value="2">2</option>
                        <option value="3">3</option>
                        <option value="4">4</option>
                        <option value="5">5</option>
                    </select>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="blockify-use-image-color" checked>
                        <span>ÁîªÂÉè„Åã„ÇâËâ≤„ÇíÊäΩÂá∫</span>
                    </label>
                </div>

                <div class="form-group">
                    <label class="label">„Éá„Éï„Ç©„É´„ÉàËâ≤</label>
                    <input type="color" class="color-picker" id="blockify-default-color" value="#64B5F6">
                </div>

                <hr style="border-color: var(--color-border); margin: 16px 0;">

                <div class="form-group">
                    <label class="label">Âá∫ÂäõÂÖà</label>
                    <select class="select" id="blockify-target" style="width: 100%;">
                        <option value="">Êñ∞Ë¶è„Éñ„É≠„ÉÉ„ÇØ„É¨„Ç§„É§„Éº</option>
                        <!-- Existing block layers populated dynamically -->
                    </select>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox" id="blockify-merge-blocks">
                        <span>Êó¢Â≠ò„Éñ„É≠„ÉÉ„ÇØ„Å®„Éû„Éº„Ç∏Ôºà‰∏äÊõ∏„Åç„Åó„Å™„ÅÑÔºâ</span>
                    </label>
                </div>

                <div class="form-group" style="background: var(--color-bg-secondary); padding: 12px; border-radius: 4px;">
                    <label class="label">„Éó„É¨„Éì„É•„Éº</label>
                    <p style="margin: 8px 0 0 0;">
                        ÁîüÊàê„Éñ„É≠„ÉÉ„ÇØÊï∞: <strong id="blockify-preview-count">0</strong>
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn--secondary" id="blockify-cancel-btn">„Ç≠„É£„É≥„Çª„É´</button>
                <button class="btn btn--primary" id="blockify-create-btn">„Éñ„É≠„ÉÉ„ÇØÂåñÂÆüË°å</button>
            </div>
        </div>
    </div>

    <!-- Layer Context Menu -->
    <div class="context-menu hidden" id="layer-context-menu">
        <!-- Items populated dynamically -->
    </div>

    <!-- Startup Dialog -->
    <div class="modal-overlay" id="startup-dialog">
        <div class="modal startup-modal">
            <div class="startup-header">
                <h1 class="startup-title">HexBreaker Editor</h1>
                <p class="startup-subtitle">„Éò„ÉÉ„ÇØ„Çπ„Ç∞„É™„ÉÉ„Éâ „Éñ„É≠„ÉÉ„ÇØÂ¥©„Åó„Ç®„Éá„Ç£„Çø„Éº</p>
            </div>
            <div class="startup-buttons">
                <button class="startup-btn startup-btn--primary" id="btn-startup-new">
                    <i class="fas fa-plus"></i>
                    <span>Êñ∞Ë¶è„Éó„É≠„Ç∏„Çß„ÇØ„Éà</span>
                </button>
                <button class="startup-btn startup-btn--secondary" id="btn-startup-open">
                    <i class="fas fa-folder-open"></i>
                    <span>„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÇíÈñã„Åè</span>
                </button>
            </div>
        </div>
    </div>

    <!-- New Project Wizard -->
    <div class="modal-overlay hidden" id="new-project-wizard">
        <div class="modal wizard-modal">
            <div class="wizard-header">
                <span class="modal-title">Êñ∞Ë¶è„Éó„É≠„Ç∏„Çß„ÇØ„Éà‰ΩúÊàê</span>
                <div class="wizard-steps">
                    <div class="step-indicator active" data-step="1">1</div>
                    <div class="step-connector"></div>
                    <div class="step-indicator" data-step="2">2</div>
                    <div class="step-connector"></div>
                    <div class="step-indicator" data-step="3">3</div>
                </div>
            </div>

            <!-- Step 1: Base Layer -->
            <div class="wizard-step" id="wizard-step-1">
                <div class="wizard-step-title">„Éô„Éº„Çπ„É¨„Ç§„É§„Éº„ÅÆË®≠ÂÆö</div>
                <div class="wizard-step-desc">ËÉåÊôØÁîªÂÉè„Åæ„Åü„ÅØÂçòËâ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>

                <div class="wizard-content">
                    <!-- Image Drop Zone -->
                    <div class="drop-zone" id="wizard-drop-zone">
                        <div class="drop-zone-content">
                            <i class="fas fa-image drop-zone-icon"></i>
                            <p>ÁîªÂÉè„Çí„Éâ„É©„ÉÉ„Ç∞ÔºÜ„Éâ„É≠„ÉÉ„Éó</p>
                            <p class="drop-zone-hint">„Åæ„Åü„ÅØ</p>
                            <button class="btn btn--secondary" id="btn-wizard-select-image">
                                „Éï„Ç°„Ç§„É´„ÇíÈÅ∏Êäû
                            </button>
                        </div>
                    </div>
                    <input type="file" id="file-input-wizard-image" accept="image/*" style="display:none">

                    <!-- Image Preview -->
                    <div class="image-preview-container hidden" id="wizard-image-preview">
                        <img id="wizard-preview-img" class="preview-img" alt="Preview">
                        <div class="preview-info">
                            <span id="wizard-image-name">image.png</span>
                            <span id="wizard-image-size">1280 x 720 px</span>
                        </div>
                        <button class="btn btn--icon btn--small" id="btn-wizard-clear-image">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="form-divider">
                        <span>„Åæ„Åü„ÅØ</span>
                    </div>

                    <!-- Solid Color Mode -->
                    <label class="checkbox-label">
                        <input type="checkbox" id="wizard-solid-color-mode">
                        <span>ÂçòËâ≤ËÉåÊôØ„Çí‰ΩøÁî®</span>
                    </label>

                    <!-- Color Presets -->
                    <div class="wizard-panel hidden" id="wizard-color-panel">
                        <label class="label">ËÉåÊôØËâ≤</label>
                        <div class="color-preset-grid">
                            <button class="bg-color-preset" data-color="#FFFFFF" style="background:#FFFFFF" title="ÁôΩ"></button>
                            <button class="bg-color-preset" data-color="#000000" style="background:#000000" title="Èªí"></button>
                            <button class="bg-color-preset selected" data-color="#808080" style="background:#808080" title="„Ç∞„É¨„Éº"></button>
                            <button class="bg-color-preset" data-color="#333333" style="background:#333333" title="„ÉÄ„Éº„ÇØ„Ç∞„É¨„Éº"></button>
                        </div>
                    </div>

                    <!-- Size Panel -->
                    <div class="wizard-panel hidden" id="wizard-size-panel">
                        <label class="label">„Çµ„Ç§„Ç∫</label>
                        <div class="size-preset-buttons">
                            <button class="size-preset-btn" data-width="1280" data-height="720">1280√ó720</button>
                            <button class="size-preset-btn" data-width="1920" data-height="1080">1920√ó1080</button>
                            <button class="size-preset-btn" data-width="800" data-height="600">800√ó600</button>
                        </div>
                        <div class="size-inputs">
                            <input type="number" class="input" id="wizard-width" value="1280" min="100" max="4096">
                            <span>√ó</span>
                            <input type="number" class="input" id="wizard-height" value="720" min="100" max="4096">
                            <span>px</span>
                        </div>
                    </div>
                </div>

                <div class="wizard-footer">
                    <button class="btn btn--secondary" id="btn-wizard-cancel-1">„Ç≠„É£„É≥„Çª„É´</button>
                    <button class="btn btn--primary" id="btn-wizard-step1-next" disabled>Ê¨°„Å∏</button>
                </div>
            </div>

            <!-- Step 2: Paddle Area -->
            <div class="wizard-step hidden" id="wizard-step-2">
                <div class="wizard-step-title">„Éë„Éâ„É´È†òÂüü„ÅÆË®≠ÂÆö</div>
                <div class="wizard-step-desc">ËøΩÂä†È†òÂüü„Å®„Éó„É™„Çª„ÉÉ„Éà„ÇíË®≠ÂÆö„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>

                <div class="wizard-content">
                    <!-- Extra Area Mode -->
                    <label class="label">ËøΩÂä†È†òÂüü</label>
                    <div class="option-cards">
                        <div class="extra-area-card selected" data-mode="none">
                            <i class="fas fa-square"></i>
                            <span>„Å™„Åó</span>
                            <small>ÁîªÂÉè„Çµ„Ç§„Ç∫„ÅÆ„Åæ„Åæ</small>
                        </div>
                        <div class="extra-area-card" data-mode="external">
                            <i class="fas fa-expand"></i>
                            <span>ËøΩÂä†È†òÂüü„ÅÇ„Çä</span>
                            <small>„Éë„Éâ„É´Áî®„Çπ„Éö„Éº„Çπ„ÇíËøΩÂä†</small>
                        </div>
                    </div>

                    <!-- Extra Area Settings -->
                    <div class="wizard-panel hidden" id="wizard-extra-area-settings">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="label">‰ΩçÁΩÆ</label>
                                <select class="select" id="wizard-extra-position">
                                    <option value="bottom">‰∏ã</option>
                                    <option value="top">‰∏ä</option>
                                    <option value="left">Â∑¶</option>
                                    <option value="right">Âè≥</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="label">„Çµ„Ç§„Ç∫ (px)</label>
                                <input type="number" class="input" id="wizard-extra-size" value="100" min="50" max="500">
                            </div>
                        </div>
                    </div>

                    <div class="form-divider"></div>

                    <!-- Paddle Axis Preset -->
                    <label class="label">„Éë„Éâ„É´Ëª∏„ÅÆËá™ÂãïÁîüÊàê</label>
                    <div class="preset-cards">
                        <div class="paddle-preset-card selected" data-preset="auto">
                            <i class="fas fa-magic"></i>
                            <span>Ëá™Âãï</span>
                        </div>
                        <div class="paddle-preset-card" data-preset="none">
                            <i class="fas fa-ban"></i>
                            <span>„Å™„Åó</span>
                        </div>
                    </div>

                    <!-- Missline Preset -->
                    <label class="label">„Éü„Çπ„É©„Ç§„É≥„ÅÆËá™ÂãïÁîüÊàê</label>
                    <div class="preset-cards">
                        <div class="missline-preset-card selected" data-preset="auto">
                            <i class="fas fa-magic"></i>
                            <span>Ëá™Âãï</span>
                        </div>
                        <div class="missline-preset-card" data-preset="none">
                            <i class="fas fa-ban"></i>
                            <span>„Å™„Åó</span>
                        </div>
                    </div>
                </div>

                <div class="wizard-footer">
                    <button class="btn btn--secondary" id="btn-wizard-cancel-2">„Ç≠„É£„É≥„Çª„É´</button>
                    <div class="wizard-footer-right">
                        <button class="btn btn--secondary" id="btn-wizard-step2-back">Êàª„Çã</button>
                        <button class="btn btn--primary" id="btn-wizard-step2-next">Ê¨°„Å∏</button>
                    </div>
                </div>
            </div>

            <!-- Step 3: Grid Size & Confirm -->
            <div class="wizard-step hidden" id="wizard-step-3">
                <div class="wizard-step-title">„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„Å®Á¢∫Ë™ç</div>
                <div class="wizard-step-desc">Ë®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶‰ΩúÊàê„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>

                <div class="wizard-content">
                    <!-- Grid Size -->
                    <label class="label">„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫Ôºà„Éñ„É≠„ÉÉ„ÇØÂØÜÂ∫¶Ôºâ</label>
                    <div class="grid-size-cards">
                        <div class="grid-size-card" data-size="small">
                            <div class="grid-preview grid-preview--small"></div>
                            <span>Â∞è</span>
                            <small>10px - Á¥∞„Åã„ÅÑ</small>
                        </div>
                        <div class="grid-size-card selected" data-size="medium">
                            <div class="grid-preview grid-preview--medium"></div>
                            <span>‰∏≠</span>
                            <small>30px - Ê®ôÊ∫ñ</small>
                        </div>
                        <div class="grid-size-card" data-size="large">
                            <div class="grid-preview grid-preview--large"></div>
                            <span>Â§ß</span>
                            <small>50px - Â§ß„Åç„ÅÑ</small>
                        </div>
                    </div>
                    <p class="warning-text">
                        <i class="fas fa-exclamation-triangle"></i>
                        „Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫„ÅØ‰ΩúÊàêÂæå„Å´Â§âÊõ¥„Åß„Åç„Åæ„Åõ„Çì
                    </p>

                    <div class="form-divider"></div>

                    <!-- Summary -->
                    <div class="summary-panel">
                        <div class="summary-title">Ë®≠ÂÆö„Çµ„Éû„É™„Éº</div>
                        <div class="summary-row">
                            <span class="summary-label">„Éô„Éº„Çπ„É¨„Ç§„É§„Éº:</span>
                            <span class="summary-value" id="summary-base-layer">-</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">„Éô„Éº„Çπ„Çµ„Ç§„Ç∫:</span>
                            <span class="summary-value" id="summary-base-size">-</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">ËøΩÂä†È†òÂüü:</span>
                            <span class="summary-value" id="summary-extra-area">-</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">„Ç≠„É£„É≥„Éê„Çπ„Çµ„Ç§„Ç∫:</span>
                            <span class="summary-value" id="summary-canvas-size">-</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">„Ç∞„É™„ÉÉ„Éâ„Çµ„Ç§„Ç∫:</span>
                            <span class="summary-value" id="summary-grid-size">-</span>
                        </div>
                    </div>
                </div>

                <div class="wizard-footer">
                    <button class="btn btn--secondary" id="btn-wizard-cancel-3">„Ç≠„É£„É≥„Çª„É´</button>
                    <div class="wizard-footer-right">
                        <button class="btn btn--secondary" id="btn-wizard-step3-back">Êàª„Çã</button>
                        <button class="btn btn--primary" id="btn-wizard-create">
                            <i class="fas fa-check"></i>
                            ‰ΩúÊàê
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- File input for project loading -->
    <input type="file" id="file-input-project" accept=".hbp,.json" style="display:none">

    <!-- Scripts -->
    <script type="module">
        import { editor } from './editor/core/Editor.js?v=3';
        import { UIController } from './editor/ui/UIController.js?v=3';
        import { pixelToHex } from './shared/HexMath.js';

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', async () => {
            const mainCanvas = document.getElementById('mainCanvas');
            const overlayCanvas = document.getElementById('overlayCanvas');

            // Initialize editor (async - handles startup flow)
            await editor.init(mainCanvas, overlayCanvas);

            // Initialize UI controller
            const ui = new UIController(editor);
            ui.init();

            // Tab switching
            document.querySelectorAll('.panel-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.panel-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    const tabId = tab.dataset.tab;
                    document.querySelectorAll('.panel-content').forEach(content => {
                        content.classList.toggle('hidden', content.id !== `tab-${tabId}`);
                    });
                });
            });

            // Canvas info updates
            overlayCanvas.addEventListener('mousemove', (e) => {
                const rect = overlayCanvas.getBoundingClientRect();
                const screenX = e.clientX - rect.left;
                const screenY = e.clientY - rect.top;
                const coords = editor.renderSystem.screenToCanvas(screenX, screenY);

                document.getElementById('cursor-pos-info').textContent =
                    `X: ${Math.round(coords.x)}, Y: ${Math.round(coords.y)}`;

                const gridSize = editor.renderSystem.gridSize;
                const hex = pixelToHex(coords.x, coords.y, gridSize);
                document.getElementById('hex-pos-info').textContent =
                    `Row: ${hex.row}, Col: ${hex.col}`;
            });

            // Update canvas size info
            editor.on('canvasSizeChanged', (size) => {
                document.getElementById('canvas-size-info').textContent =
                    `${size.width} x ${size.height}`;
            });

            // Menu items
            document.getElementById('menu-new')?.addEventListener('click', () => editor.newProject());
            document.getElementById('menu-toggle-grid')?.addEventListener('click', () => editor.toggleGrid());
            document.getElementById('menu-toggle-lines')?.addEventListener('click', () => editor.toggleLines());
            document.getElementById('menu-reset-view')?.addEventListener('click', () => editor.resetView());

            console.log('HexBreaker Editor ready');
        });
    </script>
</body>

</html>